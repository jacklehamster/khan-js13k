let r=document.querySelector.bind(document);let C=r("canvas");let k=C.getContext("2d");let l=C.style;C.width=2e3;l.width=`${C.width/2}px`;C.height=1200;l.height=`${C.height/2}px`;l.border="1px solid black";l.backgroundColor="#efd";l.transition="background-color 0.5s";const c=.75;const n={};document.addEventListener("keyup",t=>{delete n[t.code]});document.addEventListener("keydown",t=>{n[t.code]=true;t.preventDefault()});const y=[];const $=[0,0];let m=true;const E={speedWhileShooting:2,speed:2,maxHealth:2,shield:0,quickShot:1,money:2};const s=6;let x=s;const t=document.body.appendChild(document.createElement("div"));t.style.position="absolute";t.style.top="10px";t.style.left="10px";function f(){const e=s+E.maxHealth*2;let n="";for(let t=0;t<Math.floor(x/2);t++){n+="â¤ï¸"}if(x%2){n+="â¤ï¸â€ðŸ©¹"}for(let t=Math.ceil(x/2);t<e/2;t++){n+="ðŸ©¶"}t.innerText=n}let O=0;const e=document.body.appendChild(document.createElement("div"));e.style.position="absolute";e.style.top="30px";e.style.left="10px";function T(){e.textContent=!O?"":`â­ ${O}`}const o=document.body.appendChild(document.createElement("div"));o.style.position="absolute";o.style.top="50px";o.style.left="10px";o.style.color="snow";o.textContent="Press ESC to continue";o.style.display="none";function u(){o.style.display=""}function a(t){const e=[];const n=new XMLHttpRequest;n.open("GET",t,false);n.overrideMimeType("text/plain; charset=x-user-defined");n.send(null);if(n.status===200){for(let t=0;t<n.responseText.length;++t){e.push(n.responseText.charCodeAt(t)&255)}}return e}let p=true;window.addEventListener("blur",function(t){p=false},false);window.addEventListener("focus",function(t){p=true},false);let q;document.addEventListener("DOMContentLoaded",()=>{const t=a("rider.13k");q=xt(t);console.log(q);dt(0)});const A=1600;const S=1e3;let d=5;function Y(n,o,r,i,a,s,d,t,c,h,e){const l=i/A;const f=a/S;n.fillStyle=t??"black";q.shapes.forEach(t=>{if(t.hidden||t.anim!==d){return}const e=t.lines[s%t.lines.length];if(e){n.beginPath();j(n,o,r,e[0]*l,e[1]*f,false,i,a,c,h);for(let t=2;t<e.length;t+=2){j(n,o,r,e[t]*l,e[t+1]*f,true,i,a,c,h)}n.closePath()}n.fill()})}function j(t,e,n,o,r,i,a,s,d,c){if(i){t.lineTo(e+o,n+r+(o/a-.5)*15*d+c*(Math.random()-.5))}else{t.moveTo(e+o,n+r+(o/a-.5)*15*d+c*(Math.random()-.5))}}const h=.5;function B(t){F[t].x=F[P-1].x;F[t].y=F[P-1].y;F[t].dx=F[P-1].dx;F[t].dy=F[P-1].dy;F[t].born=F[P-1].born;P--}let P=0;const F=[];function U(t){const{x:e,y:n,dx:o,dy:r,archerOrientation:i}=t;if(P>=F.length){F.push({})}F[P].dx=i*120+o*2;F[P].dy=-5+r*10;F[P].x=e+F[P].dx;F[P].y=n-80*c;F[P].born=t.time;P++}function _(t){const e=t.dt/20;const n=I(t.ax,t);const o=I(t.ay,t);const r=Math.sqrt(n*n+o*o);if(n!==0){t.orientation=n}const i=I(t.speed,t)*(t.dead?2:1)*(t.superSoldier&&t.soldier?.7:1);const a=t.brake;if(r){t.dx=(t.dx+n/r*i)*a;t.dy=(t.dy+o/r*i/2)*a}else{t.dx=t.dx*a;t.dy=t.dy*a}if(I(t.moving,t)){t.x+=t.dx*e;t.y+=t.dy*e}const s=Math.sqrt(t.dx*t.dx+t.dy*t.dy);t.horseFrame+=e*Math.max(.08,s/50)}function G(t){D.x=t.x;D.y=t.y+200;D.dx=0;D.dy=0;K(X).closed=true;X=null;m=false}const L={parent:true,time:0,nextShot:0,process:t=>{if(!t.parent){return}if(X){if(n.Escape){G(X);o.style.display="none"}else{return}}if(!x){if(n.Escape){x=s+E.maxHealth*2;O=0;D.dead=0;o.style.display="none";T();f()}}if(!x&&t.hero){return}_(t);if(m){t.x=Math.max(-C.width/2,Math.min(t.x,C.width/2));t.y=Math.max(-C.height/2,Math.min(t.y,C.height/2))}const e=I(t.shooting,t);if(!e){t.archerOrientation=t.orientation}else{if(t.time>t.nextShot){U(t);t.nextShot=t.time+I(t.shootPeriod,t)}}},shootPeriod:300,archerOrientation:1,orientation:1,brake:.99,speed:t=>I(t.shooting,t)?.03+E.speedWhileShooting*.02:.05+E.speed*.03,x:300,y:500,moving:t=>Math.abs(t.dx)>h||Math.abs(t.dy)>h,shooting:()=>n.Space,ax:()=>(n.KeyA||n.ArrowLeft?-1:0)+(n.KeyD||n.ArrowRight?1:0),ay:()=>(n.KeyW||n.ArrowUp?-1:0)+(n.KeyS||n.ArrowDown?1:0),dx:0,dy:0,width:250*c,height:200*c,born:0,horseFrame:0,random:0,riderAnimation:"archer",layer:0,sprites:[t=>I({...t,y:t=>I(t.y,t)-.1,parent:false,sprites:undefined,animation:t=>I(t.riderAnimation,t),range:t=>I(t.rangeOverride,t)??(I(t.shooting,t)?[0,3]:[0]),hotspot:[t=>I(t.moving,t)?.5-t.orientation*I(t.archerOrientation,t)*.05:.53,t=>I(t.moving,t)?.65+Math.sin(t.horseFrame*.7)/100:.7],color:t=>I(t.foeColor,t)??(t.corpse?t.color:t.hut?"#af8":t.tree?"#270":"black"),direction:t=>Math.sign(I(t.archerOrientation,t)),frame:t=>I(t.horseFrame,t),random:4,hidden:t=>t.dead},t),t=>I({...t,y:t=>I(t.y,t),parent:false,sprites:undefined,animation:t=>t.hut?"hut":"horse",range:t=>t.hut?[0]:I(t.moving,t)?[0,10]:[11],hotspot:[.47,.72],color:t=>t.hut&&K(t).closed?"#ba6":t.superSoldier?"#a08":t.foe?"#004":"#630",direction:t=>Math.sign(t.orientation),frame:t=>I(t.horseFrame,t),random:t=>t.superSoldier?100:4,hidden:t=>t.tree&&!t.hut||t.corpse||t.soldier},t),t=>I({...t,y:t=>I(t.y,t)+1,parent:false,sprites:undefined,animation:"shield",range:[0],hotspot:[.47,.72],color:()=>E.shield>1?"gold":"#69f",direction:t=>Math.sign(t.orientation),frame:t=>0,hidden:t=>t.foe||t.corpse||t.soldier||!E.shield},t),t=>I({...t,layer:-2,parent:false,sprites:undefined,animation:t=>t.soldier?"soldier":t.corpse?"dead":t.hut?"hut":t.tree?"tree":"horse",range:t=>t.corpse?I(t.rangeOverride,t):t.tree?[0]:I(t.moving,t)?[0,10]:[11],hotspot:t=>t.tree?[.53,1]:[.47,.72],color:"#999",direction:t=>Math.sign(t.orientation),height:-50,frame:t=>I(t.horseFrame,t),hidden:t=>t.dead&&t.soldier},t)]};function I(e,n){if(typeof e==="object"){if(Array.isArray(e)){return e.map(t=>I(t,n))}else{const o={};for(let t in e){o[t]=I(e[t],n)}return o}}return typeof e==="function"?e(n):e}function z(t,A,e,S){t.dt=e;t.time=A;const n=I(t.sprites,t);n.forEach(t=>{const{x:e,y:n,width:o,height:r,hotspot:i,foeIndex:a,dead:s,color:d,foeColor:c,superSoldier:h,hidden:l,tree:f}=t;if(l||X&&!f){return}const u=e-i[0]*o-$[0];const y=n-i[1]*r-$[1];const m=u+o;const x=y+r;if(m<0||x<0||u>C.width||y>C.height){return}if(a!==undefined&&!s){for(let t=P-1;t>=0;t--){const p=F[t];if(p.x-$[0]>u&&p.x-$[0]<m&&p.y-$[1]>y&&p.y-$[1]<x){const g=h?Math.random()<.05:true;const M=et[a];if(g){M.dead=A;V(M,A,p.dx,c??d);const v=D.x-M.x;const w=D.y-M.y;const b=Math.sqrt(v*v+w*w);M.dx=0;M.dy=0;M.goal[0]=M.x+-v/b*2e3;M.goal[1]=M.y+-w/b*2e3;O+=(h?60:10)*(1+.5*E.money);T()}else{M.hitTime=A}B(t);if(E.quickShot){D.nextShot=A+50}}}}S.push(t)})}const H={};function J(t){let{x:e,y:n,width:o,height:r,animation:i,horseFrame:a,range:s,hotspot:d,color:c,time:h,hitTime:l,dead:f,direction:u,dy:y,random:m,hidden:x,cache:p,hero:g,hut:M}=t;if(M&&!K(t).closed){R=t}if(l&&h-l<50){c=g?"red":"white"}let v=s[0]+(s.length<=1?0:Math.floor(a)%(s[1]-s[0]+1));const w=I(u,L);const b=I(y,L);if(p){const A=q.animations.indexOf(i);const S=`${i}-${v}-${c}-${w}-${o}-${r}`;let t;if(!H[S]){t=document.createElement("canvas");H[S]={canvas:t};t.width=o;t.height=r;t.getContext("2d").lineWidth=6;t.getContext("2d").strokeStyle="black";Y(t.getContext("2d"),w<0?o:0,r<0?-r:0,o*w,r,v,A,c,0,0)}t=H[S].canvas;k.drawImage(t,e-d[0]*o-$[0],n-(r<0?0:d[1]*r)-$[1]+W);return}const A=q.animations.indexOf(i);Y(k,e-d[0]*o*w-$[0],n-d[1]*r-$[1]+W,o*w,r,v,A,c,b,m)}const N=60;const Q=1e3/N;let g=0;let M=0;function v(e){if(typeof e==="object"){if(Array.isArray(e)){const o=[...e];for(let t=0;t<o.length;t++){o[t]=v(e[t])}return o}const n={...e};for(let t in n){n[t]=v(e[t])}return n}return e}const D={...v(L),hero:true};let W=0;let w=0;const i=[];function V(t,e,r,n){const o={...v(L),corpse:true,horseFrame:0,x:t.x,y:t.y,rangeOverride:[0,4],range:undefined,archerOrientation:r<0?1:-1,cache:true,riderAnimation:"dead",born:e,color:n,process:t=>{const e=t.time-t.born;const n=Math.floor(e/50);const o=I(t.rangeOverride[1],t);t.horseFrame=Math.min(n,o);if(t.horseFrame<o){t.x+=r*t.dt/1e3}},width:t.width,height:t.height};if(i.length>200){i.shift()}i.push(o);return o}let Z=0;const tt=100;const et=new Array(tt).fill(0).map((t,e)=>{const n=Math.random()*Math.PI*2;const o=Math.cos(n);const r=Math.sin(n);const h=e/tt<.05;const i=e%3<=1;const a=o*(2e3+Math.random()*1e3);const s=r*(2e3+Math.random()*1e3);const d={...v(L),superSoldier:h,foeIndex:e,foeColor:h?i?"blue":"#a00":i?"#75f":"#f0a",horseFrame:Math.floor(Math.random()*100),goal:[a,s],gdist:0,ax:t=>(t.goal[0]-d.x)/2e3,ay:t=>(t.goal[1]-d.y)/2e3,x:a,y:s,rangeOverride:t=>!I(t.moving,t)?[0]:i?[0,4]:[0,3],speed:i?Math.max(.01,Math.random()/30):Math.max(.03,Math.random()/20),archerOrientation:t=>Math.sign(I(t.dx,t)),cache:true,soldier:i,process:o=>{if(!o.parent){return}if(o.dead&&o.time-o.dead>5e3){o.dead=0;o.speed=o.soldier?Math.max(.025,Math.random()/30):Math.max(.03,Math.random()/20)}_(o);const t=o.x-o.goal[0];const e=o.y-o.goal[1];o.gdist=Math.sqrt(t*t+e*e);const n=o.x-D.x;const r=o.y-D.y;const i=Math.sqrt(n*n+r*r);if(i<50&&!o.dead&&x){Z+=o.superSoldier?5:1;console.log("HIT",Z,(D.time-D.born)/1e3+"s");x=Math.max(0,x-(h?2:1));f();w=40;l.backgroundColor="#a00";setTimeout(()=>{l.backgroundColor="#efd"},150);if(!x){V(D,D.time,(D.x-o.x)*2,D.color);D.dead=D.time;u()}const t=Math.random()*Math.PI*2;const e=Math.cos(t);const n=Math.sin(t);o.x=D.x+e*2e3;o.y=D.y+n*2e3;D.dx=0;D.dy=0;D.hitTime=D.time}if(R||!x){if(!o.pausing){o.pausing=true;const a=o.x-(R??D).x;const s=o.y-(R??D).y;const d=Math.sqrt(a*a+s*s);o.goal[0]=D.x+a/d*2e3;o.goal[1]=D.y+s/d*2e3}}else{if(o.pausing){o.pausing=false}if(i>2500){if(Math.random()<.6||!D.dx&&!D.dy){const t=Math.random()*Math.PI*2;const e=Math.cos(t);const n=Math.sin(t);o.x=D.x+e*1500;o.y=D.y+n*1500}else{const c=Math.sqrt(D.dx*D.dx+D.dy*D.dy);o.x=D.x+D.dx*(1e3+Math.random()*500)/c+(Math.random()-.5)*300;o.y=D.y+D.dy*(1e3+Math.random()*500)/c+(Math.random()-.5)*300}if(o.dead){o.dead=0;o.speed=o.soldier?Math.max(.025,Math.random()/30):Math.max(.03,Math.random()/20)}o.gdist=0}if(o.gdist<100||i>(o.soldier?500:3e3)){o.goal[0]=D.x+(D.x-o.x)+(Math.random()-.5)*(o.soldier?200:300);o.goal[1]=D.y+(D.y-o.y)+(Math.random()-.5)*(o.soldier?200:300)}}},foe:true,width:(i?200*c:220*c)*(h?i?2:1.5:1),height:(i?180*c:180*c)*(h?i?2:1.5:1),riderAnimation:i?"soldier":"sword"};return d});let R=null;let X=null;const nt={};const ot=30;const rt=new Array(ot).fill(0).map((t,e)=>{const r=e<=1;const i=r?2e4:4e3;const a=i/2+500;const n={...v(L),cache:true,x:r?e*i:Math.random()*4e3-2e3,y:r?e*i/2:Math.random()*4e3-2e3,cellX:0,cellY:0,index:e,process:t=>{if(!t.parent){return}const e=t.x-D.x;const n=t.y-D.y;const o=Math.sqrt(e*e+n*n);if(o<(r?80:50)){if(r&&!K(t).closed){if(!X){X=t;t.enteredHut=t.time;x=s+E.maxHealth*2;f();u()}}else{w=20;D.x-=e;D.y-=n;D.dx=0;D.dy=0}}if(e>a*2){t.x-=i*2;t.cellX--}else if(e<-a*2){t.x+=i*2;t.cellX++}if(n>a){t.y-=i;t.cellY--}else if(n<-a){t.y+=i;t.cellY++}},foe:true,width:(r?600:500)*c,height:(r?400:350+Math.random()*200)*c,riderAnimation:r?"hut":"tree",foeColor:r?`rgb(${200}, ${100+e*55}, ${50+e*50})`:`rgb(${Math.random()*30}, ${Math.random()*150}, ${Math.random()*20})`,tree:true,hut:r,rangeOverride:r?[1]:undefined};return n});function K(t){const e=`${t.cellX}_${t.cellY}_${t.index}`;return nt[e]??(nt[e]={})}function it(t,e){const n=t.x-e.x;const o=t.y-e.y;return n*n+o*o}function at(){const e=rt.filter(t=>t.hut&&!K(t).closed);let n=e[0];for(let t=1;t<e.length;t++){if(it(e[t],D)<it(n,D)){n=e[t]}}return n}const st=[et,i,rt];let b=null;function dt(e){requestAnimationFrame(dt);if(e-g<=Q||!p){return}g=Math.max(g,e-100);const n=e-g;const o=n/20;g=e;if(w){W=Math.random()*w;w*=.5;if(w<.1){w=0}}k.clearRect(0,0,C.width,C.height);k.beginPath();k.strokeStyle="#038";k.lineWidth=6;for(let t=0;t<P;t++){const s=F[t];const P=50;const d=Math.sqrt(s.dx*s.dx+s.dy*s.dy)+1;k.moveTo(s.x-$[0],s.y-$[1]+W);k.lineTo(s.x-$[0]-s.dx/d*P,s.y-$[1]+W-s.dy/d*P);s.dy+=.3;s.x+=s.dx/d*P*o;s.y+=s.dy/d*P*o}k.stroke();for(let t=P-1;t>=0;t--){if(e-F[t].born>1500){B(t)}}k.strokeStyle="#380";k.lineWidth=2;y.length=0;ct(y);z(D,e,n,y);st.forEach(t=>t.forEach(t=>z(t,e,n,y)));y.sort((t,e)=>{if(t.layer!==e.layer){return t.layer-e.layer}return Math.sign(t.y-e.y)});R=null;y.forEach(t=>J(t,e));const t=at();const r=t.x-D.x;const i=t.y-D.y;const a=Math.sqrt(r*r+i*i);if(a>2e3){if(!b){b=[D.x,D.y]}k.beginPath();const c=2e3;const h=D.x+r/a*c-$[0];const l=D.y+i/a*c-$[1];b[0]+=(h-b[0])*.1;b[1]+=(l-b[1])*.1;k.arc(Math.min(C.width-100,Math.max(100,b[0])),Math.min(C.height-100,Math.max(100,b[1])),15,0,2*Math.PI);k.fill()}if(!x){const f=Math.min(.7,(e-D.dead)/3e3);k.fillStyle=`rgb(200,0,0,${f})`;k.fillRect(0,0,C.width,C.height);k.fill()}else if(!X){if(!m){M+=((D.dx*D.archerOrientation<0?0:D.dx)/2+D.archerOrientation*2-M)*.05;$[0]+=D.dt/20*(D.x-C.width/2-$[0]+M*80)*.1;$[1]+=D.dt/20*(D.y-C.height/2-$[1]+D.dy*50)*.1}else{$[0]=-C.width/2;$[1]=-C.height/2}}else{const u=Math.min(1,(e-X.enteredHut)/500);k.fillStyle=`rgb(0,0,0,${u})`;k.fillRect(0,0,C.width,C.height);k.fill()}}function ct(){const n=200;k.beginPath();const o=[Math.round($[0]/n),Math.round($[1]/n)];for(let e=-15;e<15;e++){for(let t=-20;t<20;t++){const r=t+o[0];const i=e+o[1];const a=Math.sin(r*123+i*9991)+Math.sin(r*123/10+i*9991/100)+Math.sin(r*123/10+i*9991/100);const s=Math.cos(r*12331+i*2221)+Math.cos(r*12331/10+i*2221/10)+Math.cos(r*12331/100+i*2221/100);const d=a*500;const c=s*200;const h=r*n-$[0]+d;const l=i*n-$[1]+c;k.moveTo(h,l+W);k.lineTo(h+a*100,l+W+3);k.lineTo(h+a*100+s*100,l+W)}}k.stroke()}f();T();function ht(e){const n=new Array(Math.ceil(e.length*2));for(let t=0;t<e.length;t++){n[t*2]=e[t]%16;n[t*2+1]=(e[t]>>4)%16}return n}function lt(t){const e=[0,0];let n=0,o=0;do{n=t.pop()-7;o=t.pop()-7;e[0]+=n;e[1]+=o}while(n||o);let r,i;do{n=t.pop()-7;o=t.pop()-7;if(n||o){const a=r*o;const s=i*n;if(Math.abs(a-s)<5){e[e.length-2]+=n;e[e.length-1]+=o}else{e.push(e[e.length-2]+n,e[e.length-1]+o)}r=n;i=o}}while(n||o);return e}function ft(e,n){const o=new Array(e.pop());for(let t=0;t<o.length;t++){o[t]=lt(e).map(t=>t*n)}return o}function ut(e){const n=e.pop();const o=[];for(let t=0;t<n;t++){const r=e.pop()+(e.pop()<<4);o.push(String.fromCharCode(r))}return o.join("")}function yt(e,n){const o=new Array(e.pop());for(let t=0;t<o.length;t++){o[t]={};o[t].name=ut(e);o[t].lines=ft(e,n);o[t].anim=e.pop();const r=e.pop();o[t].hidden=r===1}return o}function mt(e){const n=new Array(e.pop());for(let t=0;t<n.length;t++){n[t]=ut(e)}return n}function xt(t){const e=ht(t);const n={};e.reverse();const o=e.pop();n.animations=mt(e);n.shapes=yt(e,o);return n}"use strict";var pt=function(){var Y=function(t){return Math.sin(t*6.283184)};var t=function(t){return 2*(t%1)-1};var e=function(t){return t%1<.5?1:-1};var n=function(t){var e=t%1*4;if(e<2)return e-1;return 3-e};var $=function(t){return.003959503758*2**((t-128)/12)};var j=function(t,e,n){var o=B[t.i[0]],r=t.i[1],i=t.i[3]/32,a=B[t.i[4]],s=t.i[5],d=t.i[8]/32,c=t.i[9],h=t.i[10]*t.i[10]*4,l=t.i[11]*t.i[11]*4,f=t.i[12]*t.i[12]*4,u=1/f,y=-t.i[13]/16,m=t.i[14],x=n*2**(2-t.i[15]);var p=new Int32Array(h+l+f);var g=0,M=0;var v,w,b,A,S,C,k;for(v=0,w=0;v<h+l+f;v++,w++){if(w>=0){m=m>>8|(m&255)<<4;w-=x;C=$(e+(m&15)+t.i[2]-128);k=$(e+(m&15)+t.i[6]-128)*(1+8e-4*t.i[7])}b=1;if(v<h){b=v/h}else if(v>=h+l){b=(v-h-l)*u;b=(1-b)*3**(y*b)}g+=C*b**i;S=o(g)*r;M+=k*b**d;S+=a(M)*s;if(c){S+=(2*Math.random()-1)*c}p[v]=80*S*b|0}return p};var B=[Y,e,t,n];var U,_,G,z,J;this.init=function(t){U=t;_=t.endPattern;G=0;z=t.rowLen*t.patternLen*(_+1)*2;J=new Int32Array(z)};this.generate=function(){var t,e,H,n,o,r,i,a,s,d,D,W,R,c,h,l,X;var f=new Int32Array(z),u=U.songData[G],y=U.rowLen,m=U.patternLen;var x=0,p=0,g;var M,v=false;var w=[];for(n=0;n<=_;++n){a=u.p[n];for(o=0;o<m;++o){var b=a?u.c[a-1].f[o]:0;if(b){u.i[b-1]=u.c[a-1].f[o+m]||0;if(b<17){w=[]}}var A=B[u.i[16]],S=u.i[17]/512,C=2**(u.i[18]-9)/y,k=u.i[19],$=u.i[20],E=u.i[21]*43.23529*3.141592/44100,O=1-u.i[22]/255,T=u.i[23]*1e-5,q=u.i[24]/32,P=u.i[25]/512,K=6.283184*2**(u.i[26]-9)/y,F=u.i[27]/255,L=u.i[28]*y&~1;h=(n*m+o)*y;for(r=0;r<4;++r){i=a?u.c[a-1].n[o+r*m]:0;if(i){if(!w[i]){w[i]=j(u,i,y)}var I=w[i];for(e=0,t=h*2;e<I.length;e++,t+=2){f[t]+=I[e]}}}for(e=0;e<y;e++){s=(h+e)*2;c=f[s];if(c||v){l=E;if(k){l*=A(C*s)*S+.5}l=1.5*Math.sin(l);x+=l*p;g=O*(c-p)-x;p+=l*g;c=$==3?p:$==1?g:x;if(T){c*=T;c=c<1?c>-1?Y(c*.25):-1:1;c/=T}c*=q;v=c*c>1e-5;d=Math.sin(K*s)*P+.5;M=c*(1-d);c*=d}else{M=0}if(s>=L){M+=f[s-L+1]*F;c+=f[s-L]*F}f[s]=M|0;f[s+1]=c|0;J[s]+=M|0;J[s+1]+=c|0}}}G++;return G/U.numChannels};this.createAudioBuffer=function(t){var e=t.createBuffer(2,z/2,44100);for(var n=0;n<2;n++){var o=e.getChannelData(n);for(var r=n;r<z;r+=2){o[r>>1]=J[r]/65536}}return e};this.createWave=function(){var t=44;var e=t+z*2-8;var n=e-36;var o=new Uint8Array(t+z*2);o.set([82,73,70,70,e&255,e>>8&255,e>>16&255,e>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,n&255,n>>8&255,n>>16&255,n>>24&255]);for(var r=0,i=t;r<z;++r){var a=J[r];a=a<-32767?-32767:a>32767?32767:a;o[i++]=a&255;o[i++]=a>>8&255}return o};this.getData=function(t,e){var n=2*Math.floor(t*44100);var o=new Array(e);for(var r=0;r<2*e;r+=1){var i=n+r;o[r]=t>0&&i<J.length?J[i]/32768:0}return o}};